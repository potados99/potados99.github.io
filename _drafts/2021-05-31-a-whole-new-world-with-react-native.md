---
title: "React Native로 전환하고 신세계를 경험중입니다"
summary: "카페테리아 앱을 React Native로 다시 작성했습니다. 하고 싶은 얘기가 너무 많아요오오오"
date: 2021-05-31 10:22:43 +0900
categories:
   - dev
---

우리 학교 앱센터에서 굴리는 앱 중에 `카페테리아`라고 있는데, 이 앱을 최근에 처음부터 다시 작성헀습니다. 이걸 하면서 느낀 점들을 써 봅니다. 사실 5월달에 완성하고 지금 글을 쓰는 시점에서는 2주 정도가 지난 후라 기억이 잘 안 나지만(오늘만 보고 삽니다..) 일단 써볼게요. 기술적인 사실을 전달하기보다는 주절주절에 가까운 글이니 가볍게 읽어주시면 되겠습니다 ㅎㅎ

## 배경

5월 초에 학교 내 소비자생활협동조합에서 전화가 왔습니다. 카페테리아 iOS 앱에 잘못 표기된 문구가 있다는 것이었습니다. 정말 간단하게 단어 하나만 바꾸면 그 문제는 해결되는 것이었는데, 생각해보니까 문제가 그게 다가 아니었습니다. 학교 학식당에는 코너가 여러 개 있고, 학기마다 코너 이름이나 메뉴 편성이 자주 바뀌어 왔습니다. 그런데 iOS 앱에는 코너 이름이 하드코딩되어 있어 서버쪽 API의 변화를 따라가지 못하는 문제가 있었습니다.

사실 카페테리아 서비스를 뜯어고치기로 결심한 후로 1년 조금 넘는 시간 동안 안드로이드 앱을 두 번 갈아엎고 서버도 갈아엎고 배포와 운영을 위한 시스템까지 만들어 놓았으나 iOS 앱은 손도 대지 못한 상태였습니다(XCode 싫어요...앱등이지만 이건 좀..). 전체 서비스 구성 중에 딱 하나 손대지 못한 부분이 있는 것도 아쉬웠고 또 iOS 네이티브 개발을 새로 배워서 할 만큼 개발 경험에 크게 매력이 느껴지지도 않아서 어떻게 해야 하나 싶던 참에 머릿속에 React Native와 Flutter라는 두 이름이 스쳐 지나갔습니다.

## 결정의 순간

보통 모바일 앱을 만든다 하면 가장 기본적인 선택지가 각 플랫폼 위에서 네이티브 코드를 짜는 것입니다. 이게 사실 개발자 입장에서는 자연스러운건데 사용자 입장에서는 iOS든 안드로이드든 같은 앱이면 똑같이 생겼기를 기대하고 업데이트도 동시에 되기를 기대하기 마련이니 개발을 하면서 이를 따라가려면 시간과 에너지가 꽤 많이 소요됩니다. 생각만 해도 골치아팠던 것은 *iOS와 안드로이드 두 플랫폼에서 어떻게 똑같은 UI를 제공하지*였습니다. 패딩 맞추고 빌드하고 실행하고 관찰하고, 2dp만 더하고 다시 반복하고... 이걸 두 번 씩이나 하지는 못하겠더라구요.

전체 앱을 네이티브로 짜는 대신에 뼈대만 각 플랫폼 위에서 직접 만들고 내부 UI는 웹 화면으로 구성하는 것도 생각해 보았습니다. 요즈음 많은 앱들이 이렇게 구현되어 있는 것 같습니다. 일단 쇼핑몰 앱은 무조건 해당되는 것 같구요, 대부분의 은행 앱도 그랬던 것 같습니다([카카오뱅크는 네이티브래요](https://www.edaily.co.kr/news/read?newsId=01446486625835176&mediaCodeNo=257)). 그런데 사실 이 방법을 깊게 고민하지는 않았습니다. 앱 안의 브라우저에서 UI를 구동하는 것과 네이티브 위젯을 직접 띄우는 것은 분명 다르거든요. 스크롤할 때에 반응하는 속도, 무언가를 눌렀을 때의 어색한/또는 없는 페이딩 효과, 전혀 줌이 필요 없는데 핀치 투 줌이 되는 화면, 스크롤 끝자락에 보이는 여백 배경의 색상, 새로고침될 때에 깜빡이는 화면이나 화면을 뒤덮는 위협적인(?) 로딩 팝업 등등... 사용자 경험 면에서 웹 기반 앱은 압도적으로 밀립니다. 푸시알림이나 블루투스 같은 것을 제외하면 *돌아간다*는 점만 똑같고 전반적인 사용자 경험은 매우 **다.릅.니.다.** 사담이지만 알리익스프레스같은 앱을 되게 싫어합니다... 앱인 척 하는 조잡한 웹페이지라서요.

반면 매우 뛰어난 퀄리티를 가진 앱 중에 네이티브가 아니어서 꽤나 놀랐던 앱들이 몇 있습니다. 페이스북, 인스타그램, 디스코드, 그리고 자주 사용하던 배민커넥트 앱 까지요. 앞서 나열한 앱들은 React Native 기반으로 작성되었습니다. 사실 RN이 세상에 공개된지 벌써 6년이 다 되어가지만 React나 React Native 둘 다 관심이 별로 없었습니다. 그냥 React를 모바일 앱 만들 때에 쓸 수 있는거구나 싶었죠(React보단 Vue쪽을 선호하기도 했었구요.. React를 써보진 않았지만 ㅎㅎ). 그러다가 인스타그램이 RN으로 쓰인 것을 알고는 다시 한 번 인스타그램을 열어보았습니다. 배민커넥트 앱도 다시 열어보았습니다. 네이티브와 구분이 전혀 안 되는 스크롤 감도, 부드러운 화면 전환, 충분한 퍼포먼스. 이 정도로 퀄리티 높은 앱들을 떠받치는 기술이라면 도전해볼만 하겠다 싶었습니다. 그리고 React Native의 핫-리로딩과 코드푸시를 사용한 OTA 업데이트를 보고 마음이 확 기울었습니다. 그렇게 RN으로 결정했습니다.

> 왜 Flutter는 고려하지 않았냐면요... Flutter 예제 앱을 열어보고는 조금 실망했기 때문입니다. 버벅이는 스크롤과, 손가락 위치와 어긋난 스크롤 오프셋, 부자연스러운 화면전환 등등, 그냥 웹 앱과 크게 달라보이지 않았습니다. 물론 Flutter로 짜인 좋은 앱이 많습니다만, 어...그냥 RN이 맘에 들었어요 ㅎㅎ

## 기술 스택 선택

완전히 새로운 세계에 첫 발을 내딛었습니다. 분명히 모바일 앱 개발인데 그 과정은 웹 개발의 모습인게 처음에는 조금 어지러웠습니다. 정말이지 하루가 다르게 출시되는 라이브러리의 홍수와, 1년만 지난 예제도 오늘 써보면 `deprecated` 경고가 주루룩 뜨는, 정말 빠르게 변화하는 세계였습니다. 특정 기업이 주도해서 개발 프랙티스나 기술을 정하고 이끄는게 아니기 때문에 정말 많은 선택지가 있었고, 그 중에서 무얼 찾아야 하는지도 몰라서 꽤나 헤맸습니다.

### 네비게이션

템플릿으로 프로젝트를 생성해서 Hello world를 찍은 다음에 제일 먼저 고민한 것이 네비게이션이었습니다. 모바일 앱의 아주 아주 아주 아주 중요하고 기초적인데 너무 많은 사람들이 간과하는 부분이지요. 네비게이팅이 직관적이고 부드러워야 앱을 쓸 맛이 납니다! 그래서 고민을 좀 많이 했습니다.

먼저 iOS의 `UIViewContriller`와 안드로이드의 `Fragment`를 사용해 진짜 네이티브 화면 전환을 제공하는 React Native Navigation, 그리고 이런 네비게이션을 마치 네이티브인 것 마냥 모조하는 React Navigation, 이렇게 두 가지 선택지가 있었습니다. 일단 결론부터 꺼내자면 후자로 갔습니다. 처음에는 *네비게이션은 앱의 중추인데 당연히 네이티브로 가야지!* 생각이었는데, 문서와 예제, 그리고 사용자 수를 보고 생각을 바꿨습니다(ㅋㅋㅋ). 그리고 React Native Navigation의 큰 장점이 있었는데, 네비게이션 바를 조작하는게 정말 편했습니다. 바 크기부터 타이틀 텍스트 정렬, 크기, 색상, 바가 화면에 붙어있는지 또는 애니메이션과 같이 움직이는지 여부 등등, 네이티브로 구현하려면 한 개당 이틀씩 잡아먹을 문제들이 모두 깔끔하게 옵션으로 준비되어 있었습니다. 결정적으로, React Navigation을 적용한 앱을 여럿 써 보았는데요(오픈소스 라이센스 꼭 넣어주세요! 이럴 때에 도움이 된다구욧), 이때까지 네이티브인 줄로만 알았습니다. 그 정도로 깔끔한 사용자 경험을 제공한다면 믿을 수 있었죠.

### 상태 관리

다음으로는 React에 항상 따라다니는 상태 관리 프레임워크(?)가 고민이었습니다. React 하면 Redux가 보통 많이 언급되는 것 같았습니다. *아 이게 best practice구나* 하고 예제를 받아서 간단하게 돌려보는데 어.. 느낌이 영 아닌겁니다. 무슨 일을 하고 싶으면, 아무리 간단한 것이어도, 먼저 action을 정하고 reducer를 만들고 store를 만들고 dispather를 만들고... typescript를 쓴다면 일이 더 복잡해집니다. 으악! 이런 건 페이스북 같은 초대형 앱에나 어울리겠다 싶었습니다. 저에게 필요한 것은 그냥 양방향 바인딩을 지원하는 옵저버 패턴 구현체인데 말이죠.

그게 바로 MobX입니다. 안드로이드의 LiveData처럼 작동합니다. Store를 만들고 안에다가 observable 속성을 만들어 주고 그걸 컴포넌트에서 가져다가 쓰면 값에 변화가 생길 때마다 **알아서 업데이트**가 되는 기적같은 일이 일어나는거죠!

> 업데이트가 일어나면 그 하위 컴포넌트까지 모두 업데이트되기 때문에, 어떤 컴포넌트가 새로 로드되어야 하는지는 구현하면서 조금 생각해 보아야 합니다. 그리고 *변경*이라는게 무엇인지도 고민해 보아야 합니다. 특히 컨테이너(배열, 딕셔너리 등) 객체에서는요. 배열의 한 원소만 업데이트했는데 그 배열의 다른 원소를 참조하는 컴포넌트까지 모두 업데이트되면 조금 곤란하잖아요..?

카페테리아 앱에서는 MobX의 든든한 지원을 받는 store를 사실상의 뷰모델로 사용했습니다. 항상 전역적으로 떠있고, 라이프사이클의 영향을 안 받긴 하지만 말이죠. 정말 사소한 뷰 상태, 예를 들어 입력 필드의 현재 값 같은 것은 `useState()`를 사용해 컴포넌트 내의 상태로 두었습니다. Store에는 조금 더 핵심에 가까운 것들을 두었습니다. 현재 식당 정보의 배열이라든가, 사용자가 로그인되었는지 여부 같은 것들이요.

## React Native 개발 경험(DX)

### 핫 리로딩

### OTA 배포

### 군더더기 없는 구현

### 네이티브 브릿지

## 단점

### React Native Android의 한계

### OS마다 다르게 분기하는 코드

### 결국 네이티브 개발을 알아야 한다

### 혼란스러운 자바스크립트 생태계

### 말도 안 되는 Third-Party 라이브러리 이슈

### 라이브러리 지원이 언제 끊길 지 모르는 두려움


**속편: 배포 이야기, 시작시간 줄인 이야기.**
