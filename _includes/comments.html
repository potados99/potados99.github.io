<div class="divider"></div>

<h2 style="text-align: left; margin-bottom: 0;">댓글</h2>

<div id="comments-wrapper"></div>

<script>
  /**
   * utterances 스크립트 태그에 theme 속성을 직접 지정하면 고정된 값만 사용할 수 있습니다.
   * 하지만 우리는 시스템의 다크모드 설정(prefers-color-scheme)에 따라
   * 라이트 모드일 때는 'github-light', 다크 모드일 때는 'dark-blue'를 사용하고 싶습니다.
   * Jekyll은 빌드 타임에 정적 HTML을 생성하므로 브라우저의 설정을 알 수 없기 때문에,
   * JavaScript로 시스템 테마를 감지하여 동적으로 utterances를 로드해야 합니다.
   */

  const themeMap = {
    true: 'dark-blue',
    false: 'github-light',
  };

  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
  const theme = themeMap[prefersDark.matches];

  /** 감지한 테마로 utterances 스크립트를 동적으로 생성하여 삽입 */
  const script = document.createElement('script');
  script.src = 'https://utteranc.es/client.js';
  script.setAttribute('repo', 'potados99/potados99.github.io');
  script.setAttribute('issue-term', 'title');
  script.setAttribute('label', 'comment');
  script.setAttribute('theme', theme);
  script.setAttribute('crossorigin', 'anonymous');
  script.async = true;

  document.getElementById('comments-wrapper').appendChild(script);

  /** 사용자가 시스템 테마를 변경하면 utterances 테마도 실시간으로 변경 */
  prefersDark.addEventListener('change', (e) => {
    const newTheme = themeMap[e.matches];
    const iframe = document.querySelector('.utterances-frame');

    if (iframe) {
      iframe.contentWindow.postMessage(
        { type: 'set-theme', theme: newTheme },
        'https://utteranc.es'
      );
    }
  });
</script>