---
layout: default
---

<article>
  <div class="title">{{ page.title }}</div>
  <div class="post-date">{{ page.date | date: "%YÎÖÑ %-mÏõî %-dÏùº" }}</div>

  <div class="divider"></div>

  <div class="body">{{ content }}</div>

  <div class="like-button-wrapper">
    <button id="like-button" class="like-button loading">
      <span class="like-button-content">
        <span class="heart-icon">üíô</span>
        <span class="like-count">0</span>
      </span>
      <span class="like-button-loader">
        <span class="loader-dot"></span>
        <span class="loader-dot"></span>
        <span class="loader-dot"></span>
      </span>
    </button>
  </div>
</article>

<div class="comments">{% include comments.html %}</div>

<div class="page-navigation">
  <a class="home" href="/" title="Î™©Î°ùÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞"
    >&larr; Î™©Î°ùÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</a
  >
</div>

<style>
  .like-button-wrapper {
    display: flex;
    justify-content: center;
    margin: 20px 0 15px 0;
  }

  .like-button {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    font-size: 16px;
    font-weight: 500;
    border: 1px solid var(--border-primary);
    background-color: var(--bg-secondary);
    color: var(--text-primary);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    font-family: inherit;
    outline: none;
  }

  .like-button:hover:not(.loading) {
    background-color: var(--border-primary);
    border-color: var(--link-color);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(88, 166, 255, 0.2);
  }

  .like-button.loading {
    pointer-events: none;
  }

  .like-button-content {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: opacity 0.3s ease;
    opacity: 1;
  }

  .like-button.loading .like-button-content {
    opacity: 0;
    pointer-events: none;
  }

  .heart-icon {
    display: inline-block;
    font-size: 18px;
    line-height: 1;
  }

  .like-count {
    display: inline-block;
    min-width: 24px;
    text-align: center;
    font-variant-numeric: tabular-nums;
  }

  .like-button-loader {
    display: inline-flex;
    gap: 4px;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    transition: opacity 0.3s ease;
    opacity: 0;
    pointer-events: none;
  }

  .like-button.loading .like-button-loader {
    opacity: 1;
  }

  .loader-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background-color: var(--link-color);
    animation: bounceDots 1.4s infinite;
  }

  .loader-dot:nth-child(1) {
    animation-delay: 0s;
  }

  .loader-dot:nth-child(2) {
    animation-delay: 0.2s;
  }

  .loader-dot:nth-child(3) {
    animation-delay: 0.4s;
  }

  @keyframes bounceDots {
    0%, 80%, 100% {
      transform: scale(0.8);
      opacity: 0.7;
    }
    40% {
      transform: scale(1.2);
      opacity: 1;
    }
  }

  @keyframes popPulse {
    0% {
      transform: translateY(0) scale(1);
    }
    30% {
      transform: translateY(-8px) scale(1.05);
    }
    60% {
      transform: translateY(-12px) scale(1.08);
    }
    100% {
      transform: translateY(0) scale(1);
    }
  }

  @media (max-width: 480px) {
    .like-button {
      padding: 8px 12px;
      font-size: 14px;
      gap: 6px;
    }

    .heart-icon {
      font-size: 16px;
    }
  }
</style>

<script>
  const cache = {}; /* url to {id, body} */
  const url = window.location.href;
  const reaction = "üíô";

  async function getLikesCount() {
	if (cache[url]) {
		return cache[url].counts[reaction] ?? 0;
	}

    const rawResponse = await (async function () {
      const response = await fetch(
        "https://collect.potados.com/likes?response=api"
      );
      const json = await response.json();
      const parsed = json.map((e) => ({ id: e.id, body: JSON.parse(e.body) }));
      return parsed;
    })();

    const messageForThisArticle = await (async function () {
      const messagesWithThisUrl = rawResponse.filter((e) => e.body.url === url);
      if (messagesWithThisUrl.length === 0) {
        return undefined;
      }

      return messagesWithThisUrl[messagesWithThisUrl.length - 1];
    })();

    if (messageForThisArticle) {
      cache[url] = {
        id: messageForThisArticle.id,
        counts: messageForThisArticle.body.counts,
      };
    }
    
	return messageForThisArticle?.body?.counts[reaction] ?? 0;
  }

  async function increaseLikesCount() {
    const cached = cache[url];

    const payload = {
      url: url,
      counts: {
        ...cached?.counts,
        [reaction]: (cached?.counts?.[reaction] ?? 0) + 1,
      },
    };

	if (cached) {
		await fetch(`https://collect.potados.com/likes/${cached.id}?response=api`, {
			method: "PATCH",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify(payload),
		});

		cache[url].counts[reaction] = (cached.counts[reaction] ?? 0) + 1;
	} else {
		const response = await fetch(`https://collect.potados.com/likes?response=api`, {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify(payload),
		});
		const json = await response.json();
		const id = json.url.split('/').pop();

		cache[url] = {
			id: id,
			counts: payload.counts,
		};
	}
  }

  async function updateLikeButton() {
    const button = document.getElementById("like-button");
    const count = await getLikesCount();
    const countSpan = button.querySelector(".like-count");
    countSpan.textContent = count;
    button.classList.remove("loading");
  }
  
  document.addEventListener("DOMContentLoaded", async () => {
    await updateLikeButton();
  });

  document.getElementById("like-button").addEventListener("click", async () => {
    const button = document.getElementById("like-button");
    button.classList.add("loading");
    await increaseLikesCount();
    await updateLikeButton();
  });
</script>
